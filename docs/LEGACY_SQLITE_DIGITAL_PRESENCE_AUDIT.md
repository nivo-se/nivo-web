# Legacy SQLite Digital Presence Audit

**Generated by:** `scripts/audit_legacy_sqlite_digital_presence.py`
**Database:** /Volumes/Samsung_T5/Cursor Projects/nivo/data/nivo_optimized_original.db
**Mode:** Read-only (no modifications to SQLite)

---

## 1. Tables Overview

| Table | Row Count |
|-------|-----------|
| companies | 13,610 |
| financials | 66,130 |
| company_kpis | 13,610 |
| ai_profiles | 78 |
| company_status | 2 |
| clean_companies | 1,563 |
| clean_kpis | 1,563 |
| clean_llm_analysis | 24 |
| wash_runs | 0 |
| company_website_discovery | 1,565 |
| company_scrape_status | 1,564 |
| company_website_pages | 7,485 |
| company_website_extracts | 196 |
| company_website_chunks | 10,852 |
| company_insights | 0 |
| company_website_insights | 1,285 |
| company_profile | 1,283 |
| company_offerings | 7,033 |
| company_signals | 5,395 |
| company_contact | 1,283 |
| company_quality | 1,283 |
| company_dedupe | 1,283 |
| company_scores | 1,283 |
| company_taxonomy | 1,283 |
| clusters | 0 |
| company_clusters | 0 |
| company_lists | 0 |
| company_list_members | 0 |

---

## 2. Candidate Columns (URL, website, homepage, domain, email, contact, etc.)

### companies.homepage

- **Non-null count:** 2
- **Distinct values (capped 10k):** 2
- **Sample values:**
  - `https://westcoastltg.com/`
  - `https://www.ticketmaster.se/`

### companies.email

- **Non-null count:** 0
- **Distinct values (capped 10k):** 0
- **Sample values:**

### ai_profiles.website

- **Non-null count:** 0
- **Distinct values (capped 10k):** 0
- **Sample values:**

### clean_companies.homepage

- **Non-null count:** 1
- **Distinct values (capped 10k):** 1
- **Sample values:**
  - `https://www.ticketmaster.se/`

### company_website_discovery.website_url

- **Non-null count:** 1,444
- **Distinct values (capped 10k):** 1,222
- **Sample values:**
  - `https://www.ursviken.com/`
  - `https://www.bonniernews.se/`
  - `https://tantum.se/`
  - `https://www.ahlstrom.com/`
  - `https://www.mikroponent.se/`
  - `https://svenco.se/`
  - `https://www.ansell.com/en`
  - `https://sjoboelnat.se/`
  - `https://sandvikenenergi.se/elnat`
  - `https://www.varbergenergi.se/om-oss/foretaget/styrelse-och-foretagsledning/bolag-och-bolagsbeskrivni`

### company_website_discovery.source_url

- **Non-null count:** 1,562
- **Distinct values (capped 10k):** 1,562
- **Sample values:**
  - `https://www.allabolag.se/foretag/-/-/-/5560022617`
  - `https://www.allabolag.se/foretag/-/-/-/5560028796`
  - `https://www.allabolag.se/foretag/-/-/-/5560035874`
  - `https://www.allabolag.se/foretag/-/-/-/5560043332`
  - `https://www.allabolag.se/foretag/-/-/-/5560070756`
  - `https://www.allabolag.se/foretag/-/-/-/5560072778`
  - `https://www.allabolag.se/foretag/-/-/-/5560114349`
  - `https://www.allabolag.se/foretag/-/-/-/5560089186`
  - `https://www.allabolag.se/foretag/-/-/-/5560107145`
  - `https://www.allabolag.se/foretag/-/-/-/5560115510`

### company_website_discovery.search_url

- **Non-null count:** 596
- **Distinct values (capped 10k):** 394
- **Sample values:**
  - `https://www.talentplastics.se/laxa/`
  - `https://tidaholmsenergi.se/`
  - `https://tantum.se/`
  - `https://www.skanska-energi.se/privat/`
  - `https://malungselnat.se/foretaget/`
  - `https://mikroverktyg.se/`
  - `https://safeman.se/`
  - `https://skultunabruk.se/integritetspolicy`
  - `https://www.traction.se/en/`
  - `https://rotmotaverken.se/`

### company_website_discovery.redirected_to_url

- **Non-null count:** 788
- **Distinct values (capped 10k):** 439
- **Sample values:**
  - `https://rmigsolutions.com/se/`
  - `https://www.orsjo.com/`
  - `https://www.oerlikon.com/balzers/se?utm_campaign=adId_21576&utm_medium=referral&utm_source=www.indus`
  - `https://silentiascreen.com/se/`
  - `https://www.forbo.com/movement/sv-se/`
  - `https://www.trioworld.se/`
  - `https://www.wesdyne.com/`
  - `https://www.welandplastic.com/`
  - `https://www.aqgroup.com/sv/ComponentsMjallom`
  - `https://b2b.koncern.eu/`

### company_website_discovery.redirected_to_domain

- **Non-null count:** 788
- **Distinct values (capped 10k):** 438
- **Sample values:**
  - `rmigsolutions.com`
  - `orsjo.com`
  - `oerlikon.com`
  - `silentiascreen.com`
  - `forbo.com`
  - `trioworld.se`
  - `wesdyne.com`
  - `welandplastic.com`
  - `aqgroup.com`
  - `b2b.koncern.eu`

### company_scrape_status.website_discovery_status

- **Non-null count:** 1,563
- **Distinct values (capped 10k):** 2
- **Sample values:**
  - `ok`
  - `missing`

### company_scrape_status.website_fetch_status

- **Non-null count:** 1,487
- **Distinct values (capped 10k):** 9
- **Sample values:**
  - `ok`
  - `error`
  - `fetch_failed`
  - `error_page:cloudflare_interstitial`
  - `insufficient_content`
  - `invalid_url`
  - `error_page:error_message:/403\s+forbidden/i`
  - `error_page:minimal_content`
  - `error_page:error_message:/access\s+denied/i`

### company_website_pages.url

- **Non-null count:** 7,485
- **Distinct values (capped 10k):** 6,150
- **Sample values:**
  - `https://www.ursviken.com/`
  - `https://www.ursviken.com/about-ursviken`
  - `https://www.ursviken.com/contact`
  - `https://www.ursviken.com/customized-presses`
  - `https://www.ursviken.com/products`
  - `https://www.ursviken.com/products/tools-and-accessories`
  - `https://www.bonniernews.se/`
  - `https://www.bonniernews.se/karriar-inom-bonnier-news`
  - `https://www.bonniernews.se/om-oss/bonnier-news-historia`
  - `https://www.bonniernews.se/om-oss/har-finns-vi`

### company_website_pages.final_url

- **Non-null count:** 7,485
- **Distinct values (capped 10k):** 5,922
- **Sample values:**
  - `https://www.bonniernews.se/post/tidnings-ab-marieberg-ett-dotterbolag-till-bonnier-news-group-ab-off`
  - `https://www.talentplastics.se/laxa/`
  - `https://tidaholmsenergi.se/`
  - `https://tantum.se/`
  - `https://www.elanders.com/swe`
  - `https://www.bolagsfakta.se/5560089186-Svenco_Papperssackar_Aktiebolag`
  - `https://www.bolagsfakta.se/5560107145-Ansell_Protective_Solutions_AB`
  - `https://www.mikroponent.se/`
  - `https://sjoboelnat.se/wp-content/uploads/2021/04/AR2020inklrev.pdf`
  - `https://sandvikenenergi.se`

### company_website_pages.different_domain

- **Non-null count:** 7,485
- **Distinct values (capped 10k):** 2
- **Sample values:**
  - `0`
  - `1`

### company_website_extracts.contact_json

- **Non-null count:** 196
- **Distinct values (capped 10k):** 176
- **Sample values:**
  - `{"emails":[],"phones":["08-12818000","2025-04-14","112 60 ","08-128 180 00"],"addresses":[]}`
  - `{"emails":["mats.andersson@talentplastics.se","bjorn.ohrman@talentplastics.se","info@talentplastics.`
  - `{"emails":["kundservice@tidaholmsenergi.se"],"phones":["0502774500","8.45-14.15 ","556063-9683 ","55`
  - `{"emails":["info@tantum.se","10info@tantum.se"],"phones":["213 77 ","040 94 20 10","040 94 20 10 "],`
  - `{"emails":["info.sweden@elanders.com","supplierinvoices@elanders.com"],"phones":["501 14 ","504 64 "`
  - `{"emails":[],"phones":["147.182.240.226 "],"addresses":[]}`
  - `{"emails":[],"phones":["64.23.238.31 "],"addresses":[]}`
  - `{"emails":["70sales@mikroponent.seMenyF"],"phones":["+46 370-69 39 70","331 37 "],"addresses":[]}`
  - `{"emails":[],"phones":[],"addresses":[]}`
  - `{"emails":["info@sandvikenenergi.se","info@sandvikenenergi.seTelefon","info@sandvikenergi.seFirst"],`

### company_website_chunks.url

- **Non-null count:** 10,852
- **Distinct values (capped 10k):** 5,458
- **Sample values:**
  - `http://abtbolagen.se/jobba-hos-oss`
  - `http://abtbolagen.se/kontakt`
  - `http://b-oindustriservice.se/`
  - `http://elitkomposit.se/`
  - `http://gjuteribolaget.se/about`
  - `http://gjuteribolaget.se/kontakta-oss`
  - `http://gjuteribolaget.se/om-oss`
  - `http://gjuteribolaget.se/tjanster`
  - `http://iac-ab.se/en/about-iac`
  - `http://iac-ab.se/en/about-iac/history`

### company_contact.emails_json

- **Non-null count:** 1,283
- **Distinct values (capped 10k):** 583
- **Sample values:**
  - `[]`
  - `["press@bonniernews.se"]`
  - `["kundservice@tidaholmsenergi.se"]`
  - `["info@tantum.se","thomas.thornblad@tantum.se","jonas.hammartorp@tantum.se","daniel.karlsson@tantum.`
  - `["annemiek.voorzee@ahlstrom.com","tricia.schwartz@ahlstrom.com","tomi.lindell@ahlstrom.com"]`
  - `["valberedning@elanders.com","info@elanders.com","apacsales@mentormedia.com","info@bergenlogistics.c`
  - `["mail@svenco.se","jessica@svenco.se","john@svenco.se","jan@svenco.se","joacim@svenco.se","anna@sven`
  - `["info@sjoboelnat.se"]`
  - `["kundservice@varbergenergi.se"]`
  - `["mats.w.lundberg@sandvik.com","info@sandvik.com"]`

### company_contact.emails_count

- **Non-null count:** 1,283
- **Distinct values (capped 10k):** 22
- **Sample values:**
  - `0`
  - `1`
  - `10`
  - `3`
  - `11`
  - `6`
  - `2`
  - `14`
  - `13`
  - `9`

---

## 3. Coverage by orgnr

### companies

- **Total orgnr (non-empty):** 13,610
- **Orgnr with at least 1 URL:** 2
- **Orgnr with at least 1 email:** 0
- **Orgnr with both:** 0

### ai_profiles

- **Total orgnr (non-empty):** 78
- **Orgnr with at least 1 URL:** 0
- **Orgnr with at least 1 email:** 0
- **Orgnr with both:** 0

### clean_companies

- **Total orgnr (non-empty):** 1,563
- **Orgnr with at least 1 URL:** 1
- **Orgnr with at least 1 email:** 0
- **Orgnr with both:** 0

### company_website_discovery

- **Total orgnr (non-empty):** 1,565
- **Orgnr with at least 1 URL:** 1,444
- **Orgnr with at least 1 email:** 0
- **Orgnr with both:** 0

### company_scrape_status

- **Total orgnr (non-empty):** 1,564
- **Orgnr with at least 1 URL:** 1,563
- **Orgnr with at least 1 email:** 0
- **Orgnr with both:** 0

### company_website_pages

- **Total orgnr (non-empty):** 1,384
- **Orgnr with at least 1 URL:** 1,384
- **Orgnr with at least 1 email:** 0
- **Orgnr with both:** 0

### company_website_chunks

- **Total orgnr (non-empty):** 1,297
- **Orgnr with at least 1 URL:** 1,297
- **Orgnr with at least 1 email:** 0
- **Orgnr with both:** 0

### company_contact

- **Total orgnr (non-empty):** 1,283
- **Orgnr with at least 1 URL:** 0
- **Orgnr with at least 1 email:** 1,283
- **Orgnr with both:** 0

---

## 4. Join Keys

| Table | Has orgnr? | orgnr column |
|-------|------------|--------------|
| companies | Yes | orgnr |
| financials | Yes | orgnr |
| company_kpis | Yes | orgnr |
| ai_profiles | Yes | org_number |
| company_status | Yes | orgnr |
| clean_companies | Yes | orgnr |
| clean_kpis | Yes | orgnr |
| clean_llm_analysis | Yes | orgnr |
| wash_runs | No | — |
| company_website_discovery | Yes | orgnr |
| company_scrape_status | Yes | orgnr |
| company_website_pages | Yes | orgnr |
| company_website_extracts | Yes | orgnr |
| company_website_chunks | Yes | orgnr |
| company_insights | Yes | orgnr |
| company_website_insights | Yes | orgnr |
| company_profile | Yes | orgnr |
| company_offerings | Yes | orgnr |
| company_signals | Yes | orgnr |
| company_contact | Yes | orgnr |
| company_quality | Yes | orgnr |
| company_dedupe | Yes | orgnr |
| company_scores | Yes | orgnr |
| company_taxonomy | Yes | orgnr |
| clusters | No | — |
| company_clusters | Yes | orgnr |
| company_lists | No | — |
| company_list_members | Yes | orgnr |

---

## 5. Proposed Mapping Plan (Refined)

### Best Sources (by coverage)

| Source Table.Column | Orgnr with data | Target (Postgres) | Priority |
|---------------------|-----------------|-------------------|----------|
| `company_website_discovery.website_url` | 1,444 | companies.homepage | 1 (preferred) |
| `company_website_discovery.redirected_to_url` | 788 | fallback if website_url null | 2 |
| `company_contact.emails_json` | 1,283 | companies.email | 1 |

### URL Normalization Rules

- Trim whitespace
- Prefer `https://`; add if missing for valid domains
- Reject: Allabolag URLs (`allabolag.se`), bolagsfakta URLs, generic search URLs
- Reject: URLs longer than 500 chars (likely junk)
- For homepage: prefer root/base URL; avoid deep paths like `/page/subpage` when a shorter canonical exists (use `website_url` from discovery as primary)

### Email Normalization Rules

- Parse `emails_json` (JSON array); take first valid email
- Lowercase
- Basic validation: contains `@`, no spaces, reasonable length
- Reject: IP addresses, malformed strings in contact_json

### Conflict Rules

- **Only fill** Postgres `homepage` / `email` when currently NULL or empty
- Prefer `company_website_discovery.website_url` over `redirected_to_url` for homepage
- For `company_contact`: use first non-empty email from `emails_json` array

### Estimated Impact

| Field | Legacy orgnr with data | Postgres currently empty | Est. updates (only-missing) |
|-------|------------------------|--------------------------|-----------------------------|
| homepage | 1,444 | ~13,608 | ~1,444 |
| email | 1,283 | ~13,610 | ~1,283 |
| both | overlap ~1,200+ | — | — |
